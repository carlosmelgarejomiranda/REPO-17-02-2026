<analysis>**original_problem_statement:**
The user has initiated a complete, ground-up refactoring of the entire UGC (User-Generated Content) application. The primary goals are to overhaul the database structure for better scalability and maintainability, and then adapt the entire application to this new structure.

Key principles for this project are:
-   Zero data loss during migration.
-   Zero loss of existing functionality.
-   All database schema changes, no matter how small, must be explicitly approved by the user before implementation.

The project is divided into phases, starting with redefining the core data models (credentials, users, companies, brands, campaigns), migrating the data, and then refactoring the application screen by screen to work with the new database schema.

**User's preferred language**: Spanish

**what currently exists?**
The application is a full-stack platform (React/FastAPI/MongoDB). A major database refactoring has been performed.

1.  **New DB Schema:** A comprehensive, normalized database schema has been designed, approved, and implemented. This includes new collections like , , , and , and the restructuring of all existing UGC-related tables. The definitive schema is documented in .
2.  **Data Migration:** The data from the old structure has been migrated to the new schema. This involved splitting collections (e.g.,  into  and a cleaned ), normalizing IDs, creating correct foreign key relationships, and cleaning orphaned/test data.
3.  **Login/Register Flow:** The user authentication and registration system (both standard and Google OAuth) has been successfully adapted to the new  schema. This included fixing password hashing inconsistencies and implementing a mandatory phone number capture for new OAuth users.
4.  **Screen Index:** A complete index of all frontend screens to be refactored has been created at .

**Last working item**:
-   **Last item agent was working:** The agent completed the adaptation of the Login and Registration flow (standard email/password and Google OAuth). This involved backend changes to use , adding a  field to the  collection, creating an endpoint to update phone numbers, and modifying the frontend to show a modal for mandatory phone capture.
-   **Status:** COMPLETED
-   **Agent Testing Done:** Y
-   **Which testing method agent to use?** Frontend testing agent. The agent should test the full registration and login flow for both standard users and Google OAuth users, verifying the phone number capture modal appears when needed.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   There are no pending issues. The agent is waiting for instructions on the next task.

**In progress Task List**:
-   **Task 1: Refactor the entire application to use the new database schema (P0)**
    -   **Where to resume:** The user and agent have agreed to proceed screen by screen. The agent has recommended starting with the **Gestión Campañas** screen () but is awaiting user confirmation.
    -   **What will be achieved with this?** This is the main ongoing project. The goal is to make the entire application functional again by aligning all backend endpoints and frontend components with the new, normalized database structure.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** Both
    -   **Blocked on something:** User confirmation on which screen to work on next.

**Upcoming and Future Tasks**
**Upcoming Tasks:**
-   **P0: Adapt Gestión Campañas screen** ().
-   **P1: Adapt all other Admin Panel screens** (Creators, Brands, Deliverables).
-   **P1: Adapt Creator and Brand dashboard screens.**

**Future Tasks:**
-   Design and implement tables for Creator Levels/Points/Benefits.
-   Design and implement tables for Product Monetization (Plans/Subscriptions).
-   Eliminate the public application flow (users must have an account).
-   Configure production webhooks (Sentry, UptimeRobot).
-   Implement a Global Admin Search feature.
-   Integrate Bancard Payment Gateway.

**Completed work in this session**
-   **Production Backup Verified**: Confirmed that the Python-based backup system works correctly in the user's production environment.
-   **Preview DB Synced**: Restored the preview database with fresh data from a production backup.
-   **Database Schema Refactor (Design & Creation)**: Defined and created over 15 new and restructured collections with proper relationships and indexes, based on user-provided documents.
-   **Database Data Migration**: Migrated all existing data to the new schema, handling data splitting, cleanup of orphaned records, and ensuring data integrity.
-   **Login/Register Flow Refactor**:
    -   Adapted backend and frontend for the new  schema.
    -   Fixed  vs.  inconsistency.
    -   Added a  field to the  table.
    -   Implemented a mandatory phone number capture flow for new Google OAuth users.
-   **Documentation**: Created a comprehensive index of all frontend screens to guide the refactoring process ().

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Incorrect Instagram Handle for Lurdes brand**
    -   The  for the brand Lurdes contains a full URL instead of just the handle. This was noted in a previous session.
    -   **Why to solve this?** To ensure data consistency and that social media links are generated correctly.
    -   **Should Test frontend/backend/both after fix?** Backend.
    -   **Status**: NOT STARTED

**Known issue recurrence from previous fork**
-   **Issue recurrence in previous fork:** Production Backup Failure.
-   **Recurrence count:** High.
-   **Status:** RESOLVED. The Python-based backup script was confirmed by the user to be working in production.

**Code Architecture**


**Key Technical Concepts**
-   **Database Normalization**: The core activity is a massive refactoring of the MongoDB schema from a few denormalized collections to over 15 normalized collections with clear Foreign Key relationships and indexes.
-   **Schema-First Development**: All development is strictly guided by a user-provided schema document (), and the user must approve any deviation.
-   **Incremental Refactoring**: The application is being rebuilt screen by screen, starting with the most fundamental parts (Login/Register) and moving towards core business logic screens.

**key DB schema**
The entire database schema has been redefined. The source of truth is ****. Key tables include , , , , , , , , , and .

**changes in tech stack**
-   None. The stack remains React, FastAPI, and MongoDB.

**All files of reference**
-   : **CRITICAL**. The definitive blueprint for the new database schema. All work must conform to this file.
-   : The agreed-upon roadmap for refactoring the frontend screens.
-   : The main backend file, which will be heavily modified throughout the refactor.

**key api endpoints**
-   , , , : These have been adapted to the new schema.
-   : A new endpoint to support mandatory phone capture.
-   **All other application-specific API endpoints are outdated** and will be refactored as their corresponding screens are updated.

**Critical Info for New Agent**
-   **The Refactor is the Only Priority:** Your entire focus is on adapting the application to the new database schema. Do not get sidetracked by other features unless the user explicitly changes priorities.
-   **The Schema Document is Law:** You MUST adhere strictly to the schema defined in . Read it carefully.
-   **Confirm All DB Changes:** Before implementing any change that modifies the database schema (adding/removing a field), you MUST explain why it's needed and get explicit authorization from the user.
-   **Follow the Screen-by-Screen Plan:** The agreed-upon process is to refactor one screen at a time. The next likely candidate is Gestión Campañas, but you must confirm this with the user before starting.
-   **Clarity is Crucial:** The user has previously expressed frustration with misunderstandings. Be extremely clear in your communication, especially when discussing data structures. Always confirm your understanding before executing complex tasks.

**documents and test reports created in this job**
-   
-    (Provided by user, but is the central document for this job)

**Last 10 User Messages and any pending HUMAN messages**
1.  **User (Msg 228):** Asks which fields are not filled when using Google OAuth. (Completed)
2.  **Agent (Msg 231):** Explains that  is missing and  is an extra field. (Completed)
3.  **User (Msg 232):** Asks for a recommendation. (Completed)
4.  **Agent (Msg 233):** Recommends making phone capture mandatory and adding the  field to the  table, noting it's a DB change and asking for authorization. (Completed)
5.  **User (Msg 234):** Authorizes the changes. (Completed)
6.  **Agent (Msg 311):** Confirms implementation of the login/register flow is complete and tested. (Completed)
7.  **User (Msg 312):** Asks which screen to work on next. (Completed)
8.  **Agent (Msg 313):** Recommends starting with the Gestión Campañas screen and asks for confirmation. (Pending User Response)

**Project Health Check:**
-   **Broken:** The entire application (except for login/register) is functionally broken because the frontend and backend logic do not match the new database schema. This is expected and is the subject of the ongoing refactoring task.
-   **Mocked**: None.

**3rd Party Integrations**
-   **Cloudinary**: Used for storing backups and images.
-   **Resend**: Used for sending email notifications.
-   **MongoDB Atlas**: The database service used in the production environment.
-   **Emergent-managed Google Auth**: For user authentication.

**Testing status**
-   **Testing agent used after significant changes:** NO
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** []
-   **Known regressions:** The entire application is in a regressed state by design, pending the completion of the refactoring project.

**Credentials to test flow:**
-   **Admin User:**  / 

**What agent forgot to execute**
-   The agent initially misinterpreted the migration plan for  and , and also used an incorrect schema document for verification. Both issues were corrected after the user pointed them out. The next agent must be diligent in using the correct, user-provided documents as the single source of truth.</analysis>
