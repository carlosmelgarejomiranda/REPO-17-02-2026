<analysis>**original_problem_statement:**
The user's initial goal was to fix bugs and improve infrastructure stability. This evolved into a multi-phase project to perform a comprehensive database overhaul (cleaning, normalization, optimization). The project was blocked due to user concerns about data loss from an incomplete backup script.

The agent fixed the backup script, addressed several data integrity issues discovered along the way, and restored the user's confidence. The current task is to create a comprehensive manual detailing every screen and function of the UGC (User-Generated Content) system. This manual will serve as a reference to ensure no functionality is lost during the upcoming database migration and refactoring.

**User's preferred language**: Spanish

**what currently exists?**
The application is a full-stack UGC platform (React/FastAPI/MongoDB). A robust, unified backup script () is now in place, which creates a 100% complete backup of all collections (including GridFS legacy data) to Cloudinary, complete with a verification manifest (). The admin panel features a single button to trigger this backup, which runs as a background task to prevent timeouts.

Several critical data integrity issues have been resolved:
- The  collection has been normalized. Test data was removed, and the primary key has been standardized to  across all records.
- The  and a new  file document the corrected database structure.
- A new feature in the admin panel allows exporting any database collection to an  file with user-selectable fields.

**Last working item**:
-   **Last item agent was working:** The agent was just beginning to work on the user's new request: to create a comprehensive technical manual for the entire UGC system. The user provided a detailed example for the Manage Campaigns screen, specifying the level of detail required (data sources, database updates, actions per screen). The agent had started analyzing the frontend components and backend routes related to the UGC module.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N/A
-   **Which testing method agent to use?** N/A (Documentation task)
-   **User Testing Done:** N/A

**All Pending/In progress Issue list**:
-   **Issue 1: Database Migration Plan Blocked (Now Unblocked)**
    -   **Description:** The primary project of normalizing and migrating the database was on hold due to data integrity concerns.
    -   **Fixes:** This has been resolved. A 100% reliable backup script is complete, and major data inconsistencies in  have been fixed. The user is now confident to proceed but wants to document the system first.
    -   **Status:** RESOLVED
-   **Issue 2: Data inconsistencies in  (Priority: P2)**
    -   **Description:** The brand Lurdes has an incorrect  (contains a full URL), leading to a malformed .
    -   **Next debug checklist:**
        1.  Create a script to find the brand Lurdes.
        2.  Extract the handle from the  field.
        3.  Update the document with the corrected  and a properly generated .
    -   **Why fix this issue and what will be achieved with the fix?** To ensure data consistency and prevent broken links in the UI.
    -   **Status:** NOT STARTED
    -   **Should Test frontend/backend/both after fix?** Backend

**In progress Task List**:
-   **Task 1: Create Comprehensive UGC System Manual (Priority: P0)**
    -   **Where to resume:** The agent has identified the relevant frontend components and backend routes. The next step is to systematically go through each UGC screen, document its functionality, data sources, and database interactions as per the user's detailed example. Start with the Manage Campaigns and Manage Applications screens.
    -   **What will be achieved with this?** A complete guide to the current UGC system, which will be crucial for rebuilding the functionality on top of a new database structure without losing features. This is the user's main prerequisite before starting the migration.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** N/A
    -   **Blocked on something:** No

**Upcoming and Future Tasks**
**Upcoming Tasks:**
-   **P1: Database Migration Plan (Post-Manual)**
    -   **Phase 1: Preparation:** Use the 100% complete backup from production and load it into the preview environment.
    -   **Phase 2: Cleaning:** Write and execute a script to delete obsolete collections (legacy GridFS, temporary image collections).
    -   **Phase 3: Normalization:**
        -   Convert all date fields currently stored as strings to proper BSON Date types ().
        -   Unify phone number storage. The current plan is to make the user onboarding process update  to serve as the single source of truth.
        -   Consolidate   and  fields.
    -   **Phase 4 & 5: Validation & Production Deploy:** Validate the cleaned data and plan the final migration to the production environment.
-   **P1: Implement Phone Number Capture for Google OAuth Users**
    -   As per user request, implement a solution to capture the user's phone number when they register via Google OAuth. The agreed-upon proposal is a combination of a mandatory modal post-login and a persistent banner if the user skips it.

**Future Tasks:**
-   **P2: Eliminate Public Application Flow:** After the DB migration, remove the apply without account feature.
-   **P2: Configure Production Webhooks:** Guide the user to set up Sentry and UptimeRobot webhooks.
-   **P2: Global Admin Search Feature.**
-   **P2: Bancard Payment Gateway Integration.**
-   **P2: Address Redundant Fields:** Decide whether to remove fields identified as redundant (e.g., , , ,  in creators/brands).

**Completed work in this session**
-   **Critical Backup System Overhaul:**
    -   Identified that the existing backup script was skipping empty and critical collections (, ).
    -   Rewrote  into a single, unified script that creates a 100% complete backup, including all collections, empty collections, and GridFS chunks.
    -   The script now generates a  with checksums for verification, runs as a background task to prevent timeouts, uploads to Cloudinary, and cleans up old backups.
    -   Simplified the Admin Panel UI to a single Create Backup button that triggers this robust process.
-   **Data Integrity and Normalization:**
    -   Fixed a critical issue in  where most records lacked a primary key (). Backed up the data, deleted 3 test records, and migrated the uid=0(root) gid=0(root) groups=0(root) field to  for 351 records.
    -   Identified that ratings were stored in two places ( and the  collection), explaining a UI discrepancy.
    -   Discovered that all date fields in the database are stored as strings, not BSON Date objects. Confirmed this is a design issue, not a backup data loss issue.
-   **New Features & Tools:**
    -   Created an Export to Excel feature in the admin panel to download any collection with selectable fields.
    -   Generated a complete, corrected Entity Relationship Diagram (ERD) in eraser.io format and saved it to .
-   **Bug Fixes & Investigations:**
    -   Fixed a  bug in an admin endpoint.
    -   Fixed a production deployment issue with the backup endpoint by replacing FastAPI's  with Python's standard  library for better compatibility.
    -   Conducted a detailed analysis of where phone numbers are stored, identifying inconsistencies across , , and .

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Creator Data Model Consolidation**
    -   The  model has a legacy  object and a new  array that should be consolidated. This is now part of the upcoming Database Migration Plan.
-   **Issue 2: Deprecate GridFS Code**
    -   Service files and routes related to the old GridFS storage system should be removed after confirming the legacy images are no longer needed.
-   **Issue 3: Inconsistent Phone Number Storage**
    -   Phone numbers are stored in , , , and  without a single source of truth. This is planned to be fixed during the migration.

**Code Architecture**


**Key Technical Concepts**
-   **Robust Data Backups:** The new standard is a single script that captures all collections (including empty and GridFS chunks), generates a manifest with MD5 checksums for verification, and uploads to Cloudinary.
-   **Background Task Processing:** Using Python's  library to run long processes like database backups without causing API request timeouts.
-   **Data Normalization:** Performed a critical fix on  to standardize the primary key, a process involving backup, deletion of bad data, and scripted updates.
-   **Database Schema Investigation:** Deep analysis of the database to identify data inconsistencies, redundant fields, and design flaws (e.g., dates as strings).
-   **File Generation (Backend):** Using  to dynamically create and serve  Excel files from database queries.
-   **ERD Generation:** Documenting a complex database structure using a code-based diagramming tool format (eraser.io).

**key DB schema**
-   **ugc_applications:** **NORMALIZED**. The primary key is now consistently . The old uid=0(root) gid=0(root) groups=0(root) field has been removed/renamed. Records from the public flow (which had a different structure) were identified as test data and deleted.
-   **ugc_deliverables:** Contains an embedded  object, which is the true source for ratings shown in the UI, not the  collection.
-   **ugc_campaigns:** Contains an embedded  (exchange/offer) object. It was determined this has a 1:1 relationship with campaigns and does not need to be its own collection.
-   **Date Fields:** It was confirmed that all date/time fields across the database are stored as **strings in ISO format**, not as native BSON Date types. This is a design flaw to be addressed in the migration.

**All files of reference**
-   : The single, definitive script for all database backups.
-   : The main UI for all new admin tools (backup, export, inspection).
-   : The official documentation of the database schema, now updated.
-   : A new file containing the complete ERD code for diagramming.
-   : Folder where local database backups were stored during critical operations.

**Critical Info for New Agent**
-   The user's highest priority is now to **document the existing UGC system** before making any further changes. Your immediate task is to create the manual as requested.
-   The backup system is now considered **solved and reliable**. Do not modify  unless absolutely necessary. Trust it to produce 100% complete backups.
-   The database migration is the next major project, but it should only begin **after** the UGC manual is complete and the user gives explicit approval to start. The plan for this migration is already outlined in the Upcoming Tasks.
-   Pay close attention to the user's detailed example for the manual. They expect a screen-by-screen breakdown, including data sources and database updates for each action.

**documents and test reports created in this job**
-    (Updated)
-    (New)
-    (Security backup before normalization)

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Requests a single, unified backup script instead of two.
2.  **User:** Asks for a single button in the admin panel to trigger the backup, not multiple.
3.  **User:** Reports the new backup button is failing in production (timeout error).
4.  **User:** Clarifies that the error occurred *after* redeploying the changes.
5.  **User:** **Requests a comprehensive manual of the entire UGC system**, screen by screen, detailing data sources and database updates. Provides a detailed example. This is the current active task.
6.  **User:** Asks about the last backup file.
7.  **User:** Asks what other collections exist that are not in the backup or preview environment.
8.  **User:** Asks for clarification on why 11 collections were mentioned instead of records.
9.  **User:** Asks to include the collections that are not in any environment.
10. **User:** I want to solve this. I want a backup of all collections, always. And I want methods to verify that all records from all collections are contained in the backup. (This led to the final robust backup script).

**Project Health Check:**
-   **Broken:** None. The previous blocker (backup integrity) is resolved.
-   **Mocked**: None.

**3rd Party Integrations**
-   **Resend**: For platform emails.
-   **Emergent-managed Google Auth**: For user authentication.
-   **Gemini Vision**: For AI metric extraction.
-   **WhatsApp**: For direct contact links.
-   **Cloudinary**: For all file storage, including database backups.
-   **Sentry**: For error monitoring.
-   **UptimeRobot**: For availability monitoring.

**Testing status**
-   **Testing agent used after significant changes:** NO
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** []
-   **Known regressions:** None.

**Credentials to test flow:**
-   **Admin User:**  / 
-   **Cloudinary Credentials:** Available in .
-   **Sentry DSN:** Available in .

**What agent forgot to execute**
-   The agent is actively working on the user's latest request (creating the UGC manual). Nothing has been forgotten.</analysis>
